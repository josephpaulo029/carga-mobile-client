<ion-header>
    <ion-navbar>
        <button ion-button menuToggle>
        <ion-icon name="menu"></ion-icon>
        </button>
        <ion-title>
            My Packages
        </ion-title>
    </ion-navbar>
</ion-header>

<ion-content>
    <ion-refresher (ionRefresh)="getWithoutLoading(filter, $event)">
        <ion-refresher-content></ion-refresher-content>
    </ion-refresher>
    <div text-center margin-top *ngIf="isLoading">
        <ion-spinner></ion-spinner>
    </div>
    <ion-item *ngIf="!isLoading">
        <ion-label>
            <ion-icon name="checkbox-outline"></ion-icon>
            Type
        </ion-label>
        <ion-select [(ngModel)]="filter.deliveryStatus" (ngModelChange)="getPackages(filter)">
            <ion-option value="pending">Pending</ion-option>
            <ion-option value="inProgress">In Progress</ion-option>
            <ion-option value="completed">Completed</ion-option>
        </ion-select>
    </ion-item>
    <h4 ion-text class="no-packages" text-center *ngIf="!isLoading && !packages.length">No packages</h4>
    <ion-list margin-top *ngIf="!isLoading && packages.length">
        <ion-card *ngFor="let package of packages" (click)="visitPackage(package)">
            <ion-card-content>
                <ion-grid>
                    <ion-row>
                        <ion-col text-left class="location-text">
                            {{package.custom && package.custom.pickupLocationAddressString}}
                        </ion-col>
                        <ion-col text-center>
                            <ion-icon class="arrow-right" ios="ios-arrow-round-forward" md="md-arrow-round-forward"></ion-icon>
                        </ion-col>
                        <ion-col text-right class="location-text">
                            {{package.custom && package.custom.destinationAddressString}}
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col text-center>
                            <ion-note>
                                <ion-icon name="calendar" class="package-icon"></ion-icon>
                                {{package.pickupDate | date:"MM/dd/yy - h:mm a "}}
                            </ion-note>
                        </ion-col>
                    </ion-row>
                    <ion-row>
                        <ion-col col-5>
                            <ion-note>
                                {{package.packageTypeDisplay || ''}}
                            </ion-note>
                        </ion-col>
                        <ion-col col-5>
                            <ion-note>
                                {{package.dimension}}
                            </ion-note>
                        </ion-col>
                        <ion-col col-2>
                            <ion-note>
                                {{package.weight}} kg
                            </ion-note>
                        </ion-col>
                    </ion-row>
                    
                    <div class="cancel-delivery" text-center *ngIf="package.deliveryStatus =='pending.clientRequest'" (click)="$event.stopPropagation();cancelDelivery(package)">
                        Cancel delivery
                    </div>
                </ion-grid>
            </ion-card-content>
            <ion-row>
                <ion-col text-center [ngClass]="{'completed': package.deliveryStatus == 'completed', 
                    'pending': package.deliveryStatus == 'pending.clientRequest' || package.deliveryStatus == 'pending.ownerAccepted',
                    'inProgress': package.deliveryStatus == 'inProgress.driverAccepted' || package.deliveryStatus == 'inProgress.driverForPickup' || package.deliveryStatus == 'inProgress.driverEnRoute' || package.deliveryStatus == 'inProgress.driverForDropoff'}">
                    <span *ngIf="package.deliveryStatus =='completed'">Package has been delivered</span>
                    <span *ngIf="package.deliveryStatus =='pending.clientRequest'">Waiting for a driver to accept your request</span>
                    <span *ngIf="package.deliveryStatus =='pending.ownerAccepted'">Owner has accepted your request. Waiting for driver confirmation.</span>
                    <span *ngIf="package.deliveryStatus =='inProgress.driverAccepted'">Driver has accepted your request.</span>
                    <span *ngIf="package.deliveryStatus =='inProgress.driverForPickup'">Driver will pick up your package</span>
                    <span *ngIf="package.deliveryStatus =='inProgress.driverEnRoute'">Driver is on the way to destination.</span>
                    <span *ngIf="package.deliveryStatus =='inProgress.driverForDropoff'">Driver is about to drop off your package.</span>
                </ion-col>
            </ion-row>
        </ion-card>
    </ion-list>

</ion-content>